<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Street View</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <link href="assets/css/material-kit.css?v=2.0.5" rel="stylesheet" />
    <!--This link failed-->

    <style>
        body {
            margin: 0;
        }

        #streetview { position:absolute; top:0; bottom:0; width:100%; }

        .map-overlay {
            font: 20px inherit ;
            background-color: rgba(46, 46, 46, 0.8);
            position: absolute;
            width: 22%;
            height: 100%;
            border-radius: 3px;
            top: 0;
            left: 0;
            padding: 0px;
        }

        .map-overlay .map-overlay-inner {
            padding: 10px;
            margin-bottom: 10px;
        }

        .map-overlay table {
            border: none;
            width: 100%;
            display: inline-block;
            padding: 0px;
        }

        .map-overlay .bottonlist{
            display: block; /* Make the buttons appear below each other */
            padding: 10px 0px;
        }


        .map-overlay .button:hover {background-color: rgba(255, 255, 255, 0.3)}

        .map-overlay .radiobutton{
            font: 16px inherit ;
        }

        .map-overlay .viewButton {
            background-color: Transparent;
            border:1px solid #FFFFFF;
            width: 120px;
            color: white;
            border-radius: 3px;
            padding: 5px 20px;
            text-align: center;
            text-decoration: none;
            display: inline;
            font: 14px inherit ;
            cursor: pointer; /* Pointer/hand icon */

        }

        .map-overlay .viewButton:hover {background-color: rgba(255, 255, 255, 0.3)}

        h2,
        h3,
        h4,
        h5,
        h6
        {
            color: #ffffff;
            display: block;
            margin: 10px 0px;
        }

        p{
            color: #ffffff;
            font: 8px inherit;
        }


        .map-overlay label {
            font-size: 12px;
            color: #ffffff;
            horiz-align: center;
            padding: 10px 10px 20px 10px;
        }

        .collapsible {
            background-color: Transparent;
            width: 100%;
            color: white;
            font-size: 14px;
            border: none;
            padding: 5px;
            text-align: left;
            display: block;
            cursor: pointer;
        }

        .active .collapsible:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .collapsible:after {
            content: '\002B';
            color: white;
            font-weight: bold;
            float: right;
        }

        .active:after {
            content: "\2212";
        }

        .content {
            padding: 0 10px;
            display: none;
            overflow: hidden;
            background-color: rgba(89, 89, 89, 0.5);
        }

        #legend {
            font-size: 12px;
            width: 100%;
            height: 40px;
            padding: 5px 10px;
        }

        .row {
            position: center;
            height: 12px;
            width: 90%;
            padding-left: 5px;
        }

        .colors {
            background: linear-gradient(to right, #32e458,#eab71f,#e55720,#bf1c1c,#800d2d,#441038);
            margin-bottom: 5px;
        }

        .legendLabel {
            width: 15%;
            color: #FFFFFF;
            display: inline-block;
            text-align: left;
        }
    </style>

</head>
<body>
<div id='streetview'>
    <!-- Modify the style: right position so it matches with the mapbox attribution -->
    <div id="attribution" class="mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-ctrl-bottom-right" style="position: fixed; bottom: 0; right: 230px;">
        <a href="https://www.mapbox.com/about/maps/">© Mapbox</a> &nbsp;|&nbsp;
        <a href="https://www.openstreetmap.org/about/">© OpenStreetMap</a>  &nbsp;|&nbsp;
        <a href="https://data.london.gov.uk/dataset/laei-2008-concentration-maps?resource=159b2b40-d881-4ee5-88e2-09cbf0e1c012">London Data Store</a>  &nbsp;|&nbsp;
        <a href="https://apps.mapbox.com/feedback/?owner=uczlqju&id=cjv3rkko11j721fqr3s1xekl1&access_token=pk.eyJ1IjoidWN6bHFqdSIsImEiOiJjam4zOXRjMHUwY3htM3BteXgxazVxZ3QzIn0.mmRn_HjpXDzMJrKj1apGNQ">Improve this map</a> &nbsp;|
    </div>
</div>

<div class='map-overlay top'>
    <div class='map-overlay-inner'>
        <h3>Air Pollutant Emission in Central London</h3>

        <h5>Year</h5>
        <table><tr><td>
            <input type="radio" class="radiobutton" name="year" id="2008"><label>2008</label>
            <input type="radio" class="radiobutton" name="year" id="2011"><label>2011</label>
            <input type="radio" class="radiobutton" name="year" id="2015" checked><label>2015</label>
        </td></tr>
        </table>

        <h5>Choose view: </h5>
        <div class="bottonlist">
            <button class="viewButton" id="3D">Street View</button>
            <button class="viewButton" id="top">Airscape</button>
        </div>

        <h5>Emission Volume (μg/m3)</h5>
        <div id="legend">
            <div class='row colors'></div>
            <div class='legendLabel'>0</div>
            <div class='legendLabel'>30</div>
            <div class='legendLabel'>60</div>
            <div class='legendLabel'>90</div>
            <div class='legendLabel'>120</div>
            <div class='legendLabel'>900</div>

        </div>

        <h5>Explore by Pollutants</h5>
        <div class="bottonlist">
            <button class="collapsible"  id="NO2a" checked>NO2 Annual Mean</button>
            <div class="content">
                <p>Nitrogen dioxide is mainly generated by vehicle emissions. It indicates the presence of other oxides
                    of nitrogen (collectively described as NOX). Colors and column heights show the distribution of
                    annual average emissions of NO2 in central London.</p>
            </div>
            <button class="collapsible"  id="NOX">NOX Annual Mean</button>
            <div class="content">
                <p>The presence of oxides of nitrogen (NOX) is highly linked to No2 concentration. Colors and column
                    heights show the distribution of annual average emissions of NOX in central London.</p>
            </div>
            <button class="collapsible" id="PM10a">PM 10 Annual Mean</button>
            <div class="content">
                <p>Heavier particulate matter such as smoke, dust from roads and construction sites, most harmful when
                    breathed into deepest part of lungs.  Primary effect on health is damage to lungs, heart and
                    circulation.Colors and column heights show the distribution of
                    annual average emissions of PM10 in central London.</p>
            </div>
            <button class="collapsible"  id="PM10e">PM 10 Exceedence</button>
            <div class="content">
                <p> Colors and column heights show the distribution of the volume of PM10
                    exceeding the EU emission limit.</p>
            </div>
            <button class="collapsible"  id="PM25e">PM 2.5 Exceedence</button>
            <div class="content">
                <p>Fine particulate matter (PM2.5) sources include burning and vehicle emissions.  It is light and remains
                    suspended in the air for a long time (it is the main visible component of pollution), causing
                    coughing, sneezing and shortness of breath.  Long term effects include asthma, chronic bronchitis
                    and heart disease. Colors and column heights show the distribution of the volume of PM2.5
                    exceeding the EU emission limit.</p>
            </div>
        </div>

    </div>
</div>


<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoidWN6bHFqdSIsImEiOiJjam4zOXRjMHUwY3htM3BteXgxazVxZ3QzIn0.mmRn_HjpXDzMJrKj1apGNQ';
    var map = new mapboxgl.Map({
        container: 'streetview',
        style: 'mapbox://styles/uczlqju/cjv3rkko11j721fqr3s1xekl1',
        center: [-0.125, 51.515],
        zoom: 12,
        minZoom: 12,
        maxZoom: 15,
        pitch: 0,
        attributionControl: false
    });



    // Set default parameters of map-loading function
    var layerField = 'NO2a_15';
    var layerHeight = ['/', ['number', ['get', layerField], 0.2], 0.2];

    map.on('load', function() {
        // Set global light properties which influence 3D layer shadows
        map.setLight({color: "#fff", intensity: 0.15, position: [1.15, 210, 30]});
        // Add standard navigation control
        map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

        // Load the 3D employment hexagon layer as a fill-extrusion type
        map.addLayer({
            id: 'buildings',
            type: 'fill-extrusion',
            source: {
                type: 'vector',
                url: 'mapbox://uczlqju.avjs4m4m' // Your Mapbox tileset Map ID
            },
            'source-layer': 'MM_CentralLondonHeights', // name of tileset
            paint: {
                'fill-extrusion-color': '#919191',
                'fill-extrusion-height': ['/', ['number', ['get', 'relh2'], 1], 1],  //expression that controls the extrusion height based on attribute
                'fill-extrusion-opacity': 1,
                'fill-extrusion-opacity-transition': {  //Opacity transition adds a delay when changing the opacity for a smooth layer change effect
                    duration: 1000,
                    delay: 0
                }
            }
        });

        map.addLayer({
            id: 'airQuality',
            type: 'fill-extrusion',
            source: {
                type: 'vector',
                url: 'mapbox://uczlqju.9ukw2j2y' //  Mapbox tileset Map ID
            },
            'source-layer': 'AirQualityInv-5jeqo4', // name of tileset
            paint: {
                'fill-extrusion-color': {
                    property: layerField,
                    type: 'exponential',
                    stops: [
                        [0, '#32e458'],
                        [10, '#32e458'],
                        [30, '#eab71f'],
                        [40, '#e55720'],
                        [80, '#bf1c1c'],
                        [100, '#800d2d'],
                        [800, '#441038']]
                },
                'fill-extrusion-height': layerHeight,  //expression that controls the extrusion height based on attribute
                'fill-extrusion-opacity': 0.8,
                'fill-extrusion-opacity-transition': {  //Opacity transition adds a delay when changing the opacity for a smooth layer change effect
                    duration: 1000,
                    delay: 0
                }
            }
        });

        // add the air pollution to the map

        var layerList = document.getElementsByClassName("collapsible");
        var yearList = document.getElementsByClassName("radiobutton");

        var buttonID = 'NO2a';

        for (var i = 0; i < layerList.length; i++) {
            var radioID;
            if (document.getElementById('2011').checked) {
                radioID = '2011';
            }
            else if (document.getElementById('2008').checked) {
                radioID = '2008';
            }
            else {
                radioID = '2015';
            }

            layerList[i].addEventListener('click', function(e) {
                buttonID = e.target.id;

                layerField = buttonID + "_" + radioID.substring(2);
                layerField = layerField.replace(/\s/g,'');

                if (buttonID === 'NOX'){
                    layerHeight = ['/', ['number', ['get', layerField], 0.7], 0.7];
                }
                else if (buttonID === 'PM10a' || buttonID === 'PM25e'){
                    layerHeight = ['/', ['number', ['get', layerField], 0.05], 0.05];
                }
                else {
                    layerHeight = ['/', ['number', ['get', layerField], 0.2], 0.2];
                }
                var paintDesign = {
                    property: layerField,
                    type: 'exponential',
                    stops: [
                        [0, '#32e458'],
                        [10, '#32e458'],
                        [30, '#eab71f'],
                        [40, '#e55720'],
                        [80, '#bf1c1c'],
                        [100, '#800d2d'],
                        [800, '#441038']]
                };

                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                };

                map.setPaintProperty('airQuality','fill-extrusion-color', paintDesign);
                map.setPaintProperty('airQuality','fill-extrusion-height', layerHeight);
            })
        }




        for (var i = 0; i < yearList.length; i++) {

            yearList[i].addEventListener('click', function(e) {
                let radioID = e.target.id;

                layerField = buttonID + "_" + radioID.substring(2);
                layerField = layerField.replace(/\s/g,'');

                if (buttonID === 'NOX'){
                    layerHeight = ['/', ['number', ['get', layerField], 0.7], 0.7];
                }
                else if (buttonID === 'PM10a' || buttonID === 'PM25e'){
                    layerHeight = ['/', ['number', ['get', layerField], 0.05], 0.05];
                }
                else {
                    layerHeight = ['/', ['number', ['get', layerField], 0.2], 0.2];
                }

                var paintDesign = {
                    property: layerField,
                    type: 'exponential',
                    stops: [
                        [0, '#32e458'],
                        [10, '#32e458'],
                        [30, '#eab71f'],
                        [40, '#e55720'],
                        [80, '#bf1c1c'],
                        [100, '#800d2d'],
                        [800, '#441038']]
                };

                map.setPaintProperty('airQuality','fill-extrusion-color', paintDesign);
                map.setPaintProperty('airQuality','fill-extrusion-height', layerHeight);
            })
        }

        // The action for view buttons
        document.getElementById("3D").addEventListener('click', function(e){
            let viewAngle = 50;
            let zoomSize = 13;
            let cor = [-0.12, 51.52];
            map.flyTo({
                centre: cor,
                zoom: zoomSize,
                pitch: viewAngle,
                speed: 0.2, // make the flying slow
                curve: 1, // change the speed at which it zooms out
            });
        });

        document.getElementById("top").addEventListener('click', function(e){
            let viewAngle = 0;
            let zoomSize = 12;
            let cor = [-0.115, 51.515];
            map.flyTo({
                centre: cor,
                zoom: zoomSize,
                pitch: viewAngle,
                speed: 0.2, // make the flying slow
                curve: 1, // change the speed at which it zooms out
            });
        });


    });


</script>

</body>
</html></html>